import{d as we,u as Ce,r as b,w as z,o as Le,c as E,a as r,b as t,e as J,f as v,t as o,g as i,h as te,v as Ne,F as h,i as y,j as M,k as Ve,n as x,l as Q,m as Se,p as je,q as Me,s as a,x as F,y as se,_ as Te}from"./index-CZ9oKmN1.js";import{_ as $e,g as Pe,a as qe,b as ze,c as Fe,d as Oe,e as Be,f as ne,h as Re,i as De}from"./slug-Btx8IQET.js";const Ae={class:"py-5 border-bottom border-dark mb-4",style:{background:"rgba(0,0,0,0.2)"}},Ge={class:"container-fluid px-4"},Ue={class:"row align-items-center"},Ee={class:"col-md-8"},Je={class:"display-6 fw-bold text-white mb-2",style:{"font-family":"'Rajdhani', sans-serif"}},Qe={class:"lead text-muted fs-6 mb-0"},Ye={class:"col-md-4 text-md-end"},Ze={class:"text-muted small mb-2"},He={class:"text-cyan fw-bold"},Ie={class:"container-fluid px-4 py-4"},Ke={class:"row g-4"},We={class:"col-lg-2 col-md-3"},Xe={class:"d-grid d-md-none mb-3"},et={class:"btn btn-outline-info",type:"button","data-bs-toggle":"offcanvas","data-bs-target":"#filterCanvas"},tt={class:"offcanvas-md offcanvas-start",tabindex:"-1",id:"filterCanvas"},st={class:"ss-panel ss-corner h-100 d-flex flex-column",style:{"background-color":"#1e252e !important"}},nt={class:"d-flex justify-content-between align-items-center p-3 pb-0 d-md-none"},ot={class:"offcanvas-title"},lt={class:"flex-grow-1 overflow-y-auto p-3"},at={class:"mb-4"},it={class:"input-group input-group-sm"},rt=["placeholder"],dt={class:"mb-4"},ct={class:"d-flex flex-wrap gap-1"},ut=["onClick"],vt={class:"mb-4"},bt={class:"d-flex flex-wrap gap-1"},mt=["onClick"],gt={class:"mb-4"},_t={class:"d-flex flex-wrap gap-1"},ft=["onClick"],pt={class:"mb-4"},ht={class:"d-flex flex-wrap gap-1"},yt=["onClick"],xt={class:"mb-4"},kt={class:"d-flex flex-wrap gap-1"},wt=["onClick"],Ct={class:"p-3 border-top border-secondary"},Lt={class:"col-lg-10 col-md-9"},Nt={key:0,class:"text-center py-5"},Vt={key:1,class:"text-center py-5 text-danger"},St={key:2,class:"ss-panel ss-corner"},jt={class:"table-responsive"},Mt={class:"table table-hover mb-0"},Tt={scope:"col",style:{width:"55%"}},$t={scope:"col",style:{width:"20%"}},Pt={scope:"col",style:{width:"20%"}},qt={key:0},zt={colspan:"4",class:"text-center py-5 text-muted"},Ft={class:"text-center text-muted ss-text-mono small"},Ot={class:"d-flex gap-3 align-items-start"},Bt={class:"rounded bg-dark d-flex align-items-center justify-content-center border border-secondary",style:{width:"50px",height:"50px","min-width":"50px",overflow:"hidden"}},Rt=["src"],Dt={key:1,class:"bi bi-box-seam text-muted"},At={class:"d-flex align-items-baseline flex-wrap gap-2"},Gt=["title"],Ut=["title"],Et=["title"],Jt={class:"small text-muted mt-1",style:{display:"-webkit-box","-webkit-line-clamp":"2","-webkit-box-orient":"vertical",overflow:"hidden","line-height":"1.5"}},Qt={class:"d-flex flex-wrap gap-1"},Yt={key:0},Zt=["onClick"],Ht={key:0,class:"text-muted ms-2"},It={key:0},Kt=["onClick"],Wt={key:0,class:"text-muted ms-2"},Xt={key:0},es={key:1,class:"text-muted small"},ts={key:3,class:"mt-4 d-flex justify-content-between align-items-center"},ss={class:"d-flex align-items-center gap-2"},ns={class:"text-muted small"},os={"aria-label":"Page navigation"},ls={class:"pagination pagination-sm ss-pagination mb-0"},as=["onClick"],is=we({__name:"ModListView",setup(rs){const Y=Se(),oe=je(),{t:d,locale:k}=Ce(),$=b(!1),T=b(null),w=b(""),g=b([]),_=b([]),f=b([]),p=b([]),L=b("sort_order desc"),N=b(10),m=b(1),Z=b([]),O=b([]),B=b([]),R=b([]),D=b([]),H=b(0),P=b(1),le=[{value:"sort_order desc",label:"推荐排序",icon:"bi bi-star-fill"},{value:"updated_at desc",label:"最近更新",icon:"bi bi-clock-history"},{value:"download_cnt desc",label:"下载量",icon:"bi bi-download"},{value:"published_at desc",label:"发布日期",icon:"bi bi-calendar-plus"},{value:"average_rating desc",label:"评分",icon:"bi bi-heart-fill"},{value:"title_cn asc",label:"名称 A-Z",icon:"bi bi-sort-alpha-down"}],V=async()=>{$.value=!0,T.value=null;try{const[n,e]=L.value.split(" "),l={page:m.value,per_page:N.value,sort:n,order:e,"filter[status_id]":99,embed:"content-collections,mod-metas,mod-versions.game-versions,content-tags"};w.value.trim()&&(l.search=w.value.trim()),g.value.length>0&&(l["filter[content_type_id]"]="in:"+g.value.join(",")),_.value.length>0&&(l["filter[tag]"]=_.value.join(",")),f.value.length>0&&(l["filter[collection]"]=f.value.join(",")),p.value.length>0&&(l["filter[game_version]"]=p.value.join(","));const s=await Pe(l);Z.value=s.data,H.value=s.meta.total,P.value=s.meta.total_pages}catch(n){T.value=n.message||"Failed to load data",console.error("Failed to fetch contents:",n)}finally{$.value=!1}},ae=async()=>{try{const[n,e,l,s]=await Promise.all([qe(),ze(),Fe(),Oe()]);O.value=n.data,B.value=e.data,R.value=l.data,D.value=s.data}catch(n){console.error("Failed to fetch metadata:",n)}},I=()=>{const n=Y.query;n.q&&(w.value=String(n.q)),n.t&&(g.value=String(n.t).split(",").map(Number).filter(e=>!isNaN(e))),n.tag&&(_.value=String(n.tag).split(",").map(Number).filter(e=>!isNaN(e))),n.col&&(f.value=String(n.col).split(",").map(Number).filter(e=>!isNaN(e))),n.v&&(p.value=String(n.v).split(",").map(Number).filter(e=>!isNaN(e))),n.sort&&(L.value=String(n.sort)),n.page&&(m.value=Number(n.page)||1),n.per&&(N.value=Number(n.per)||10)},A=()=>{const n={};w.value.trim()&&(n.q=w.value.trim()),g.value.length>0&&(n.t=g.value.join(",")),_.value.length>0&&(n.tag=_.value.join(",")),f.value.length>0&&(n.col=f.value.join(",")),p.value.length>0&&(n.v=p.value.join(",")),L.value!=="sort_order desc"&&(n.sort=L.value),m.value>1&&(n.page=String(m.value)),N.value!==10&&(n.per=String(N.value)),oe.replace({query:n})};let G=null;const ie=()=>{G&&clearTimeout(G),G=setTimeout(()=>{m.value=1,V(),A()},1e3)};z(w,()=>{ie()}),z([g,_,f,p,L,N],()=>{m.value=1,V(),A()},{deep:!0}),z(m,()=>{V(),A()}),z(()=>Y.query,(n,e)=>{JSON.stringify(n)!==JSON.stringify(e)&&(I(),V())},{deep:!0}),Le(()=>{I(),ae(),V()});const K=E(()=>Z.value),re=E(()=>H.value),de=E(()=>{const n=P.value,e=m.value,l=2,s=[];if(n<=8)for(let u=1;u<=n;u++)s.push(u);else{s.push(1);let u=Math.max(2,e-l),c=Math.min(n-2,e+l);u>2&&s.push("...");for(let q=u;q<=c;q++)s.push(q);c<n-2&&s.push("..."),s.push(n-1),s.push(n)}return s}),ce=n=>{const e=O.value.find(l=>l.id===n);return e?k.value==="zh"?e.name_cn:e.name_en:String(n)},ue=n=>{const e=B.value.find(l=>l.id===n);return e?k.value==="zh"?e.name_cn:e.name_en:String(n)},ve=n=>{const e=n["content-tags"];return!e||!Array.isArray(e)?[]:e.map(l=>l.tag_id)},S=n=>{const e=[];return n.support_cn&&e.push("CN"),n.support_en&&e.push("EN"),e},j=n=>!n["game-versions"]||n["game-versions"].length===0?[]:n["game-versions"].map(l=>D.value.find(s=>s.id===l.game_version_id)).filter(Boolean).sort((l,s)=>((s==null?void 0:s.sort_order)||0)-((l==null?void 0:l.sort_order)||0)).slice(0,2).map(l=>{if(!l)return"";const s=l.version_name.match(/^([\d.]+[a-z]?)/i);return s?s[1]:l.version_name}).filter(Boolean),be=n=>{const e=_.value.indexOf(n);e>=0?_.value.splice(e,1):_.value.push(n)},me=n=>{const e=g.value.indexOf(n);e>=0?g.value.splice(e,1):g.value.push(n)},ge=n=>{const e=p.value.indexOf(n);e>=0?p.value.splice(e,1):p.value.push(n)},_e=n=>{const e=f.value.indexOf(n);e>=0?f.value.splice(e,1):f.value.push(n)},fe=n=>{const e=R.value.find(l=>l.id===n);return e?k.value==="zh"?e.name_cn:e.name_en:String(n)},pe=n=>{const e=n["content-collections"];return!e||!Array.isArray(e)?[]:e.map(l=>l.collection_id)},W=()=>{w.value="",g.value=[],_.value=[],f.value=[],p.value=[],m.value=1},U=n=>{n>=1&&n<=P.value&&(m.value=n)},he=n=>n>=1e3?(n/1e3).toFixed(1)+"k":String(n),ye=n=>{if(!n)return"-";const e=new Date(n),l=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),u=String(e.getDate()).padStart(2,"0");return`${l}-${s}-${u}`},xe=n=>n>=1e4?"text-warning fw-bold":n>=5e3?"text-info":n>=1e3?"text-white":"text-muted",C=n=>{const e=n["mod-versions"];if(!e||e.length===0)return null;const l=Re(e);return l.length>0?l.sort((s,u)=>u.version_number.localeCompare(s.version_number,void 0,{numeric:!0,sensitivity:"base"}))[0]:e[0]},ke=n=>{const e=n["mod-versions"];return!e||e.length<=1?[]:De(e,2)},X=b(null),ee=n=>{X.value=n};return(n,e)=>{const l=Me("router-link");return a(),r("div",null,[t("header",Ae,[t("div",Ge,[t("div",Ue,[t("div",Ee,[t("h1",Je,[e[4]||(e[4]=t("i",{class:"bi bi-hdd-stack me-2 text-cyan"},null,-1)),v(o(i(d)("modList.title")),1)]),t("p",Qe,o(i(d)("modList.subtitle")),1)]),t("div",Ye,[t("div",Ze,[e[5]||(e[5]=t("i",{class:"bi bi-database me-1"},null,-1)),v(" "+o(i(d)("modList.showing"))+" ",1),t("span",He,o(re.value),1),v(" "+o(i(d)("modList.mods")),1)]),t("button",{class:"btn btn-outline-secondary btn-sm",onClick:W},[e[6]||(e[6]=t("i",{class:"bi bi-arrow-counterclockwise"},null,-1)),v(" "+o(i(d)("modList.resetFilters")),1)])])])])]),t("main",Ie,[t("div",Ke,[t("div",We,[t("div",Xe,[t("button",et,[e[7]||(e[7]=t("i",{class:"bi bi-funnel"},null,-1)),v(" "+o(i(d)("modList.openFilter")),1)])]),t("div",tt,[t("div",st,[t("div",nt,[t("h5",ot,o(i(d)("modList.filterSettings")),1),e[8]||(e[8]=t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"offcanvas","data-bs-target":"#filterCanvas"},null,-1))]),t("div",lt,[t("div",at,[t("h6",null,o(i(d)("modList.quickSearch")),1),t("div",it,[e[9]||(e[9]=t("span",{class:"input-group-text bg-dark border-secondary text-muted"},[t("i",{class:"bi bi-search"})],-1)),te(t("input",{type:"text",class:"form-control bg-dark border-secondary text-white","onUpdate:modelValue":e[0]||(e[0]=s=>w.value=s),placeholder:i(d)("modList.searchPlaceholder")},null,8,rt),[[Ne,w.value]])])]),t("div",dt,[t("h6",null,o(i(d)("modList.categories")),1),t("div",ct,[(a(!0),r(h,null,y(O.value,s=>(a(),r("button",{key:s.id,onClick:u=>me(s.id),class:x(["badge border",g.value.includes(s.id)?"bg-info text-dark border-info":"bg-transparent text-muted border-secondary"]),style:{cursor:"pointer","user-select":"none"}},o(i(k)==="zh"?s.name_cn:s.name_en),11,ut))),128))])]),t("div",vt,[t("h6",null,o(i(d)("modList.tags")),1),t("div",bt,[(a(!0),r(h,null,y(B.value,s=>(a(),r("button",{key:s.id,onClick:u=>be(s.id),class:x(["badge border",_.value.includes(s.id)?"bg-info text-dark border-info":"bg-transparent text-muted border-secondary"]),style:{cursor:"pointer","user-select":"none"}},o(i(k)==="zh"?s.name_cn:s.name_en),11,mt))),128))])]),t("div",gt,[t("h6",null,o(i(d)("modList.collections")),1),t("div",_t,[(a(!0),r(h,null,y(R.value,s=>(a(),r("button",{key:s.id,onClick:u=>_e(s.id),class:x(["badge border",f.value.includes(s.id)?"bg-info text-dark border-info":"bg-transparent text-muted border-secondary"]),style:{cursor:"pointer","user-select":"none"}},o(i(k)==="zh"?s.name_cn:s.name_en),11,ft))),128))])]),t("div",pt,[t("h6",null,o(i(d)("modList.gameVersion")),1),t("div",ht,[(a(!0),r(h,null,y(D.value,s=>(a(),r("button",{key:s.id,onClick:u=>ge(s.id),class:x(["badge border",p.value.includes(s.id)?"bg-info text-dark border-info":"bg-transparent text-muted border-secondary"]),style:{cursor:"pointer","user-select":"none"}},o(s.version_name),11,yt))),128))])]),t("div",xt,[t("h6",null,o(i(d)("modList.sortBy")),1),t("div",kt,[(a(),r(h,null,y(le,s=>t("button",{key:s.value,onClick:u=>L.value=s.value,class:x(["badge border",L.value===s.value?"bg-info text-dark border-info":"bg-transparent text-muted border-secondary"]),style:{cursor:"pointer","user-select":"none"}},[t("i",{class:x([s.icon,"me-1"])},null,2),v(o(s.label),1)],10,wt)),64))])])]),t("div",Ct,[t("button",{class:"btn btn-sm btn-outline-warning w-100",onClick:W},[e[10]||(e[10]=t("i",{class:"bi bi-arrow-counterclockwise"},null,-1)),v(" "+o(i(d)("modList.resetFilters")),1)])])])])]),t("div",Lt,[$.value?(a(),r("div",Nt,[...e[11]||(e[11]=[t("div",{class:"spinner-border text-info",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1),t("p",{class:"text-muted mt-3"},"正在扫描信号源...",-1)])])):T.value?(a(),r("div",Vt,[e[13]||(e[13]=t("i",{class:"bi bi-exclamation-triangle fs-1 d-block mb-3"},null,-1)),t("p",null,o(T.value),1),t("button",{class:"btn btn-outline-info btn-sm",onClick:V},[...e[12]||(e[12]=[t("i",{class:"bi bi-arrow-clockwise"},null,-1),v(" 重试 ",-1)])])])):(a(),r("div",St,[t("div",jt,[t("table",Mt,[t("thead",null,[t("tr",null,[e[14]||(e[14]=t("th",{scope:"col",style:{width:"50px"}},"#",-1)),t("th",Tt,o(i(d)("modList.modInfo")),1),t("th",$t,o(i(d)("modList.catsTags")),1),t("th",Pt,o(i(d)("modList.download")),1)])]),t("tbody",null,[K.value.length===0?(a(),r("tr",qt,[t("td",zt,[e[15]||(e[15]=t("i",{class:"bi bi-radar fs-1 d-block mb-3"},null,-1)),v(" "+o(i(d)("modList.noResults")),1)])])):M("",!0),(a(!0),r(h,null,y(K.value,s=>{var u;return a(),r("tr",{key:s.id,class:"mod-row"},[t("td",Ft,o(s.id),1),t("td",null,[t("div",Ot,[t("div",Bt,[s.thumbnail?(a(),r("img",{key:0,src:s.thumbnail,alt:"cover",style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,Rt)):(a(),r("i",Dt))]),t("div",null,[t("div",At,[J(l,{to:i(Be)(i(k),s.id,s.title_en),class:"fw-bold text-decoration-none text-white fs-6"},{default:F(()=>[v(o(i(k)==="zh"&&s.title_cn||s.title_en),1)]),_:2},1032,["to"]),t("span",{class:"small ss-text-mono text-tech ms-1",title:i(d)("modList.author")},[e[16]||(e[16]=t("i",{class:"bi bi-person-fill"},null,-1)),v(" "+o(s.author),1)],8,Gt),t("span",{class:x(["small ss-text-mono ms-1",xe(s.download_cnt)]),title:i(d)("modList.downloads")},[e[17]||(e[17]=t("i",{class:"bi bi-download"},null,-1)),v(" "+o(he(s.download_cnt)),1)],10,Ut),t("span",{class:"small ss-text-mono text-muted ms-1",title:i(d)("modList.updated")},[e[18]||(e[18]=t("i",{class:"bi bi-clock-history"},null,-1)),v(" "+o(ye(s.updated_at)),1)],8,Et)]),t("div",Jt,o(i(k)==="zh"&&s.short_desc_cn||s.short_desc_en),1)])])]),t("td",null,[t("div",Qt,[J(l,{to:{name:"mod-list",query:{t:s.content_type_id}},class:"badge badge-category text-decoration-none"},{default:F(()=>[v(o(ce(s.content_type_id)),1)]),_:2},1032,["to"]),(a(!0),r(h,null,y(ve(s),c=>(a(),se(l,{key:"tag-"+c,to:{name:"mod-list",query:{tag:c}},class:"badge border bg-transparent border-secondary text-decoration-none",style:{"font-size":"0.7rem",color:"#6dcff6"}},{default:F(()=>[v(o(ue(c)),1)]),_:2},1032,["to"]))),128)),(a(!0),r(h,null,y(pe(s),c=>(a(),se(l,{key:"col-"+c,to:{name:"mod-list",query:{col:c}},class:"badge border bg-transparent border-secondary text-decoration-none",style:{"font-size":"0.7rem",color:"#d4a574"}},{default:F(()=>[e[19]||(e[19]=t("i",{class:"bi bi-collection me-1"},null,-1)),v(o(fe(c)),1)]),_:2},1032,["to"]))),128))])]),t("td",null,[C(s)?(a(),r("div",Yt,[t("button",{onClick:c=>ee(C(s)),class:"btn btn-sm btn-download d-flex align-items-center text-decoration-none mb-1","data-bs-toggle":"modal","data-bs-target":"#downloadModal"},[e[20]||(e[20]=t("i",{class:"bi bi-download me-1"},null,-1)),t("span",null,o(i(ne)(((u=C(s))==null?void 0:u.version_number)||"")),1),j(C(s)).length>0||S(C(s)).length>0?(a(),r("small",Ht,[v(o(j(C(s)).join("/"))+" ",1),j(C(s)).length>0&&S(C(s)).length>0?(a(),r("span",It," - ")):M("",!0),v(" "+o(S(C(s)).join("/")),1)])):M("",!0)],8,Zt),(a(!0),r(h,null,y(ke(s),c=>(a(),r("div",{key:c.id},[t("button",{onClick:q=>ee(c),class:"btn btn-sm btn-download btn-download-secondary d-flex align-items-center text-decoration-none mb-1","data-bs-toggle":"modal","data-bs-target":"#downloadModal"},[e[21]||(e[21]=t("i",{class:"bi bi-clock-history me-1"},null,-1)),t("span",null,o(i(ne)(c.version_number)),1),j(c).length>0||S(c).length>0?(a(),r("small",Wt,[v(o(j(c).join("/"))+" ",1),j(c).length>0&&S(c).length>0?(a(),r("span",Xt," - ")):M("",!0),v(" "+o(S(c).join("/")),1)])):M("",!0)],8,Kt)]))),128))])):(a(),r("div",es,"-"))])])}),128))])])])])),!$.value&&!T.value?(a(),r("div",ts,[t("div",ss,[t("span",ns,o(i(d)("modList.perPage"))+":",1),te(t("select",{class:"form-select form-select-sm bg-dark text-white border-secondary",style:{width:"auto"},"onUpdate:modelValue":e[1]||(e[1]=s=>N.value=s)},[...e[22]||(e[22]=[t("option",{value:1},"1",-1),t("option",{value:10},"10",-1),t("option",{value:20},"20",-1),t("option",{value:50},"50",-1)])],512),[[Ve,N.value]])]),t("nav",os,[t("ul",ls,[t("li",{class:x(["page-item",{disabled:m.value===1}])},[t("a",{class:"page-link",href:"#",onClick:e[2]||(e[2]=Q(s=>U(m.value-1),["prevent"]))},"«")],2),(a(!0),r(h,null,y(de.value,(s,u)=>(a(),r("li",{key:u,class:x(["page-item",{active:m.value===s,disabled:s==="..."}])},[t("a",{class:"page-link",href:"#",onClick:Q(c=>typeof s=="number"&&U(s),["prevent"])},o(s),9,as)],2))),128)),t("li",{class:x(["page-item",{disabled:m.value===P.value}])},[t("a",{class:"page-link",href:"#",onClick:e[3]||(e[3]=Q(s=>U(m.value+1),["prevent"]))},"»")],2)])])])):M("",!0)])])]),J($e,{version:X.value},null,8,["version"])])}}}),us=Te(is,[["__scopeId","data-v-176df4b0"]]);export{us as default};
