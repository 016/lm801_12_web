import{B as V,d as I,u as B,r as k,c as F,w as N,a as d,b as n,f as y,j as L,t as r,g as b,F as j,i as S,x as c}from"./index-czzDgeLk.js";const T="https://ssdb.lib00.com/api/",u=V.create({baseURL:T,timeout:1e4,headers:{"Content-Type":"application/json"}});async function ae(){return(await u.get("/v1/content-types")).data}async function re(){return(await u.get("/v1/game-versions")).data}async function ie(){return(await u.get("/v1/tags")).data}async function le(){return(await u.get("/v1/collections")).data}async function de(e={}){const o={page:1,per_page:10,sort:"sort_order desc","filter[status_id]":99,embed:"content-collections,mod-metas,mod-versions.game-versions,content-tags"};return(await u.get("/v1/contents",{params:{...o,...e}})).data}async function ce(e){return(await u.get(`/v1/contents/${e}`,{params:{embed:"content-collections,mod-metas,mod-versions.game-versions,content-tags,mod-dependencies-by-content.content"}})).data}async function z(e){return(await u.get(`/v1/mod-versions/${e}`,{params:{embed:"mod-version-downloadses"}})).data}async function O(e){await u.post(`/v1/mod-version-downloadses/${e}/increment-download`)}const U=e=>{if(!e)return"";let o=e.replace(/_(en|zh|cn)$/i,"");return/^\d/.test(o)?`v${o}`:o},ue=e=>!e||e.length===0?[]:[...e].sort((o,i)=>o.is_latest!==i.is_latest?i.is_latest-o.is_latest:i.version_number.localeCompare(o.version_number,void 0,{numeric:!0,sensitivity:"base"})),me=e=>!e||e.length===0?[]:e.filter(o=>o.is_latest===1),A={class:"modal fade",id:"downloadModal",tabindex:"-1","aria-labelledby":"downloadModalLabel","aria-hidden":"true"},E={class:"modal-dialog modal-dialog-centered"},R={class:"modal-content",style:{background:"#141c23",border:"1px solid var(--ss-border)"}},q={class:"modal-header border-secondary"},G={class:"modal-title text-white",id:"downloadModalLabel"},H={key:0,class:"text-muted small ms-2"},J={class:"px-3 pt-2 pb-0"},K={class:"text-muted"},Q={class:"modal-body"},W={key:0,class:"text-center py-3"},X={class:"ms-2 text-muted"},Y={key:1,class:"text-center py-3 text-muted"},Z={key:2,class:"d-grid gap-2"},ee=["onClick"],te={key:0,class:"text-muted small ms-2"},se={class:"badge bg-secondary"},pe=I({__name:"DownloadModal",props:{version:{}},emits:["close"],setup(e,{emit:o}){const i=e,{locale:_,t:l}=B(),w=k([]),h=k(!1),x=["quark","xunlei","uc"],C=F(()=>w.value.length?[...w.value].sort((s,t)=>{const a=s.platform_type.toLowerCase(),p=t.platform_type.toLowerCase(),v=x.indexOf(a),g=x.indexOf(p),m=v!==-1,f=g!==-1;if(_.value==="zh"){if(m&&f)return v-g;if(m&&!f)return-1;if(!m&&f)return 1}else{if(m&&f)return v-g;if(m&&!f)return 1;if(!m&&f)return-1}return a.localeCompare(p)}):[]);N(()=>i.version,async s=>{s?await D(s.id):w.value=[]},{immediate:!0});const D=async s=>{h.value=!0;try{const t=await z(s);w.value=t.data["mod-version-downloadses"]||[]}catch(t){console.error("Failed to fetch download links:",t),w.value=[]}finally{h.value=!1}},$=async s=>{window.open(s.download_url,"_blank");try{await O(s.id)}catch(t){console.error("Failed to increment download count:",t)}},M=s=>s>=1e3?(s/1e3).toFixed(1)+"k":String(s),P=s=>{const t=s.platform_type.toLowerCase();if(t==="other")try{const g=new URL(s.download_url).hostname.replace(/^www\./,"");return`${l("modDetail.downloadPlatforms.other")}: ${g}`}catch{return l("modDetail.downloadPlatforms.other")}const a=`modDetail.downloadPlatforms.${t}`,p=l(a);return p===a?s.platform_type.toUpperCase():p};return(s,t)=>(c(),d("div",A,[n("div",E,[n("div",R,[n("div",q,[n("h5",G,[t[0]||(t[0]=n("i",{class:"bi bi-cloud-arrow-down me-2 text-info"},null,-1)),y(" "+r(b(l)("modDetail.downloadModal.title"))+" ",1),e.version?(c(),d("span",H,r(b(U)(e.version.version_number)),1)):L("",!0)]),t[1]||(t[1]=n("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),n("div",J,[n("small",K,[t[2]||(t[2]=n("i",{class:"bi bi-info-circle me-1"},null,-1)),y(r(b(l)("modDetail.downloadModal.hint")),1)])]),n("div",Q,[h.value?(c(),d("div",W,[t[3]||(t[3]=n("div",{class:"spinner-border spinner-border-sm text-info",role:"status"},null,-1)),n("span",X,r(b(l)("modDetail.downloadModal.loading")),1)])):C.value.length===0?(c(),d("div",Y,[t[4]||(t[4]=n("i",{class:"bi bi-inbox fs-1 d-block mb-2"},null,-1)),y(" "+r(b(l)("modDetail.downloadModal.noLinks")),1)])):(c(),d("div",Z,[(c(!0),d(j,null,S(C.value,a=>(c(),d("button",{key:a.id,class:"btn btn-outline-info text-start d-flex justify-content-between align-items-center",onClick:p=>$(a)},[n("span",null,[t[5]||(t[5]=n("i",{class:"bi bi-cloud me-2"},null,-1)),y(" "+r(P(a))+" ",1),a.extract_password?(c(),d("span",te,"("+r(b(l)("modDetail.downloadModal.extractCode"))+": "+r(a.extract_password)+")",1)):L("",!0)]),n("span",se,r(M(a.download_cnt))+" DL",1)],8,ee))),128))]))])])])]))}});function oe(e){return e?e.toLowerCase().trim().replace(/[^a-z0-9\s-]/g,"").replace(/[\s_]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""):""}function fe(e,o,i){const _=oe(i);return _?`/${e}/mod/${o}/${_}`:`/${e}/mod/${o}`}export{pe as _,ae as a,ie as b,le as c,re as d,fe as e,U as f,de as g,oe as h,me as i,ce as j,ue as s};
