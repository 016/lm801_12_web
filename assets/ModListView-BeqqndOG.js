import{d as Ne,u as Se,r as m,w as I,o as Ve,c as J,a as r,b as t,e as Q,f as u,t as l,g as d,h as ne,v as je,F as h,i as y,j as T,k as Me,n as x,l as Y,m as Te,p as $e,q as ze,s as i,x as F,y as oe,_ as Pe}from"./index-CGpy3T-7.js";import{_ as qe,g as Fe,a as Be,b as Oe,c as Re,d as De,e as Ae,f as le,h as Ge}from"./slug-CtdLgL-W.js";const Ue={class:"py-5 border-bottom border-dark mb-4",style:{background:"rgba(0,0,0,0.2)"}},Ee={class:"container-fluid px-4"},Ie={class:"row align-items-center"},Je={class:"col-md-8"},Qe={class:"display-6 fw-bold text-white mb-2",style:{"font-family":"'Rajdhani', sans-serif"}},Ye={class:"lead text-muted fs-6 mb-0"},Ze={class:"col-md-4 text-md-end"},He={class:"text-muted small mb-2"},Ke={class:"text-cyan fw-bold"},We={class:"container-fluid px-4 py-4"},Xe={class:"row g-4"},et={class:"col-lg-2 col-md-3"},tt={class:"d-grid d-md-none mb-3"},st={class:"btn btn-outline-info",type:"button","data-bs-toggle":"offcanvas","data-bs-target":"#filterCanvas"},nt={class:"offcanvas-md offcanvas-start",tabindex:"-1",id:"filterCanvas"},ot={class:"ss-panel ss-corner h-100 d-flex flex-column",style:{"background-color":"#1e252e !important"}},lt={class:"d-flex justify-content-between align-items-center p-3 pb-0 d-md-none"},at={class:"offcanvas-title"},it={class:"flex-grow-1 overflow-y-auto p-3"},rt={class:"mb-4"},dt={class:"input-group input-group-sm"},ct=["placeholder"],ut={class:"mb-4"},mt={class:"d-flex flex-wrap gap-1"},vt=["onClick"],bt={class:"mb-4"},gt={class:"d-flex flex-wrap gap-1"},ft=["onClick"],_t={class:"mb-4"},pt={class:"d-flex flex-wrap gap-1"},ht=["onClick"],yt={class:"mb-4"},xt={class:"d-flex flex-wrap gap-1"},kt=["onClick"],wt={class:"mb-4"},Ct={class:"d-flex flex-wrap gap-1"},Lt=["onClick"],Nt={class:"p-3 border-top border-secondary"},St={class:"col-lg-10 col-md-9"},Vt={key:0,class:"text-center py-5"},jt={key:1,class:"text-center py-5 text-danger"},Mt={key:2,class:"ss-panel ss-corner"},Tt={class:"table-responsive"},$t={class:"table table-hover mb-0"},zt={scope:"col",style:{width:"55%"}},Pt={scope:"col",style:{width:"20%"}},qt={scope:"col",style:{width:"20%"}},Ft={key:0},Bt={colspan:"4",class:"text-center py-5 text-muted"},Ot={class:"text-center text-muted ss-text-mono small"},Rt={class:"d-flex gap-3 align-items-start"},Dt={class:"rounded bg-dark d-flex align-items-center justify-content-center border border-secondary",style:{width:"50px",height:"50px","min-width":"50px",overflow:"hidden"}},At=["src"],Gt={key:1,class:"bi bi-box-seam text-muted"},Ut={class:"d-flex align-items-baseline flex-wrap gap-2"},Et=["title"],It=["title"],Jt=["title"],Qt={class:"small text-muted mt-1",style:{display:"-webkit-box","-webkit-line-clamp":"2","-webkit-box-orient":"vertical",overflow:"hidden","line-height":"1.5"}},Yt={class:"d-flex flex-wrap gap-1"},Zt={key:0},Ht=["onClick"],Kt={key:0,class:"text-muted ms-2"},Wt={key:0},Xt=["onClick"],es={key:0,class:"text-muted ms-2"},ts={key:0},ss={key:1,class:"text-muted small"},ns={key:3,class:"mt-4 d-flex justify-content-between align-items-center"},os={class:"d-flex align-items-center gap-2"},ls={class:"text-muted small"},as={"aria-label":"Page navigation"},is={class:"pagination pagination-sm ss-pagination mb-0"},rs=["onClick"],ds=Ne({__name:"ModListView",setup(cs){const Z=Te(),ae=$e(),{t:c,locale:k}=Se(),z=m(!1),$=m(null),w=m(""),g=m([]),f=m([]),_=m([]),p=m([]),L=m("-sort_order,id"),N=m(10),v=m(1),H=m([]),B=m([]),O=m([]),R=m([]),D=m([]),K=m(0),P=m(1),ie=[{value:"-sort_order,id",label:"推荐排序",icon:"bi bi-star-fill"},{value:"-updated_at,id",label:"最近更新",icon:"bi bi-clock-history"},{value:"-download_cnt,id",label:"下载量",icon:"bi bi-download"},{value:"-published_at,id",label:"发布日期",icon:"bi bi-calendar-plus"},{value:"-average_rating,id",label:"评分",icon:"bi bi-heart-fill"},{value:"title_cn,id",label:"名称 A-Z",icon:"bi bi-sort-alpha-down"}],S=async()=>{z.value=!0,$.value=null;try{const s={page:v.value,per_page:N.value,sort:L.value,"filter[status_id]":99,embed:"content-collections,mod-metas,mod-versions.game-versions,content-tags"};w.value.trim()&&(s.search=w.value.trim()),g.value.length>0&&(s["filter[content_type_id]"]="in:"+g.value.join(",")),f.value.length>0&&(s["filter[tag]"]=f.value.join(",")),_.value.length>0&&(s["filter[collection]"]=_.value.join(",")),p.value.length>0&&(s["filter[game_version]"]=p.value.join(","));const e=await Fe(s);H.value=e.data,K.value=e.meta.total,P.value=e.meta.total_pages}catch(s){$.value=s.message||"Failed to load data",console.error("Failed to fetch contents:",s)}finally{z.value=!1}},re=async()=>{try{const[s,e,a,n]=await Promise.all([Be(),Oe(),Re(),De()]);B.value=s.data,O.value=e.data,R.value=a.data,D.value=n.data}catch(s){console.error("Failed to fetch metadata:",s)}},W=()=>{const s=Z.query;s.q&&(w.value=String(s.q)),s.t&&(g.value=String(s.t).split(",").map(Number).filter(e=>!isNaN(e))),s.tag&&(f.value=String(s.tag).split(",").map(Number).filter(e=>!isNaN(e))),s.col&&(_.value=String(s.col).split(",").map(Number).filter(e=>!isNaN(e))),s.v&&(p.value=String(s.v).split(",").map(Number).filter(e=>!isNaN(e))),s.sort&&(L.value=String(s.sort)),s.page&&(v.value=Number(s.page)||1),s.per&&(N.value=Number(s.per)||10)};let V=!1,q=!1;const A=()=>{const s={};w.value.trim()&&(s.q=w.value.trim()),g.value.length>0&&(s.t=g.value.join(",")),f.value.length>0&&(s.tag=f.value.join(",")),_.value.length>0&&(s.col=_.value.join(",")),p.value.length>0&&(s.v=p.value.join(",")),L.value!=="-sort_order,id"&&(s.sort=L.value),v.value>1&&(s.page=String(v.value)),N.value!==10&&(s.per=String(N.value)),V=!0,ae.replace({query:s}).finally(()=>{V=!1})};let G=null;const de=()=>{G&&clearTimeout(G),G=setTimeout(()=>{v.value=1,S(),A()},1e3)};I(w,()=>{q&&de()}),I([g,f,_,p,L,N],()=>{V||!q||(v.value=1,S(),A())},{deep:!0});const U=s=>{s>=1&&s<=P.value&&s!==v.value&&(v.value=s,S(),A())};I(()=>Z.query,(s,e)=>{V||!q||JSON.stringify(s)!==JSON.stringify(e)&&(V=!0,W(),V=!1,S())},{deep:!0,flush:"post"}),Ve(()=>{W(),re(),S(),q=!0});const X=J(()=>H.value),ce=J(()=>K.value),ue=J(()=>{const s=P.value,e=v.value,a=2,n=[];if(s<=8)for(let o=1;o<=s;o++)n.push(o);else{n.push(1);let o=Math.max(2,e-a),b=Math.min(s-2,e+a);o>2&&n.push("...");for(let C=o;C<=b;C++)n.push(C);b<s-2&&n.push("..."),n.push(s-1),n.push(s)}return n}),me=s=>{const e=B.value.find(a=>a.id===s);return e?k.value==="zh"?e.name_cn:e.name_en:String(s)},ve=s=>{const e=O.value.find(a=>a.id===s);return e?k.value==="zh"?e.name_cn:e.name_en:String(s)},be=s=>{const e=s["content-tags"];return!e||!Array.isArray(e)?[]:e.map(a=>a.tag_id)},j=s=>{const e=[];return s.support_cn&&e.push("CN"),s.support_en&&e.push("EN"),e},M=s=>!s["game-versions"]||s["game-versions"].length===0?[]:s["game-versions"].map(a=>D.value.find(n=>n.id===a.game_version_id)).filter(Boolean).sort((a,n)=>((n==null?void 0:n.sort_order)||0)-((a==null?void 0:a.sort_order)||0)).slice(0,2).map(a=>{if(!a)return"";const n=a.version_name.match(/^([\d.]+[a-z]?)/i);return n?n[1]:a.version_name}).filter(Boolean),ge=s=>{const e=f.value.indexOf(s);e>=0?f.value.splice(e,1):f.value.push(s)},fe=s=>{const e=g.value.indexOf(s);e>=0?g.value.splice(e,1):g.value.push(s)},_e=s=>{const e=p.value.indexOf(s);e>=0?p.value.splice(e,1):p.value.push(s)},pe=s=>{const e=_.value.indexOf(s);e>=0?_.value.splice(e,1):_.value.push(s)},he=s=>{const e=R.value.find(a=>a.id===s);return e?k.value==="zh"?e.name_cn:e.name_en:String(s)},ye=s=>{const e=s["content-collections"];return!e||!Array.isArray(e)?[]:e.map(a=>a.collection_id)},ee=()=>{w.value="",g.value=[],f.value=[],_.value=[],p.value=[],v.value=1},xe=s=>s>=1e3?(s/1e3).toFixed(1)+"k":String(s),ke=s=>{if(!s)return"-";const e=new Date(s),a=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${a}-${n}-${o}`},we=s=>s>=1e4?"text-warning fw-bold":s>=5e3?"text-info":s>=1e3?"text-white":"text-muted",E=s=>{const e=s["mod-versions"];if(!e||e.length===0)return[];const a=Ge(e);return a.length>0?a.sort((o,b)=>b.version_number.localeCompare(o.version_number,void 0,{numeric:!0,sensitivity:"base"})).slice(0,3):[...e].sort((o,b)=>b.version_number.localeCompare(o.version_number,void 0,{numeric:!0,sensitivity:"base"})).slice(0,1)},Ce=s=>{const e=s["mod-versions"];if(!e||e.length===0)return[];const a=E(s),n=new Set(a.map(C=>C.id)),o=Math.max(0,3-a.length);if(o===0)return[];const b=e.filter(C=>!n.has(C.id));return b.length===0?[]:b.sort((C,Le)=>Le.version_number.localeCompare(C.version_number,void 0,{numeric:!0,sensitivity:"base"})).slice(0,o)},te=m(null),se=s=>{te.value=s};return(s,e)=>{const a=ze("router-link");return i(),r("div",null,[t("header",Ue,[t("div",Ee,[t("div",Ie,[t("div",Je,[t("h1",Qe,[e[4]||(e[4]=t("i",{class:"bi bi-hdd-stack me-2 text-cyan"},null,-1)),u(l(d(c)("modList.title")),1)]),t("p",Ye,l(d(c)("modList.subtitle")),1)]),t("div",Ze,[t("div",He,[e[5]||(e[5]=t("i",{class:"bi bi-database me-1"},null,-1)),u(" "+l(d(c)("modList.showing"))+" ",1),t("span",Ke,l(ce.value),1),u(" "+l(d(c)("modList.mods")),1)]),t("button",{class:"btn btn-outline-secondary btn-sm",onClick:ee},[e[6]||(e[6]=t("i",{class:"bi bi-arrow-counterclockwise"},null,-1)),u(" "+l(d(c)("modList.resetFilters")),1)])])])])]),t("main",We,[t("div",Xe,[t("div",et,[t("div",tt,[t("button",st,[e[7]||(e[7]=t("i",{class:"bi bi-funnel"},null,-1)),u(" "+l(d(c)("modList.openFilter")),1)])]),t("div",nt,[t("div",ot,[t("div",lt,[t("h5",at,l(d(c)("modList.filterSettings")),1),e[8]||(e[8]=t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"offcanvas","data-bs-target":"#filterCanvas"},null,-1))]),t("div",it,[t("div",rt,[t("h6",null,l(d(c)("modList.quickSearch")),1),t("div",dt,[e[9]||(e[9]=t("span",{class:"input-group-text bg-dark border-secondary text-muted"},[t("i",{class:"bi bi-search"})],-1)),ne(t("input",{type:"text",class:"form-control bg-dark border-secondary text-white","onUpdate:modelValue":e[0]||(e[0]=n=>w.value=n),placeholder:d(c)("modList.searchPlaceholder")},null,8,ct),[[je,w.value]])])]),t("div",ut,[t("h6",null,l(d(c)("modList.categories")),1),t("div",mt,[(i(!0),r(h,null,y(B.value,n=>(i(),r("button",{key:n.id,onClick:o=>fe(n.id),class:x(["badge border",g.value.includes(n.id)?"bg-info text-dark border-info":"bg-transparent text-muted border-secondary"]),style:{cursor:"pointer","user-select":"none"}},l(d(k)==="zh"?n.name_cn:n.name_en),11,vt))),128))])]),t("div",bt,[t("h6",null,l(d(c)("modList.tags")),1),t("div",gt,[(i(!0),r(h,null,y(O.value,n=>(i(),r("button",{key:n.id,onClick:o=>ge(n.id),class:x(["badge border",f.value.includes(n.id)?"bg-info text-dark border-info":"bg-transparent text-muted border-secondary"]),style:{cursor:"pointer","user-select":"none"}},l(d(k)==="zh"?n.name_cn:n.name_en),11,ft))),128))])]),t("div",_t,[t("h6",null,l(d(c)("modList.collections")),1),t("div",pt,[(i(!0),r(h,null,y(R.value,n=>(i(),r("button",{key:n.id,onClick:o=>pe(n.id),class:x(["badge border",_.value.includes(n.id)?"bg-info text-dark border-info":"bg-transparent text-muted border-secondary"]),style:{cursor:"pointer","user-select":"none"}},l(d(k)==="zh"?n.name_cn:n.name_en),11,ht))),128))])]),t("div",yt,[t("h6",null,l(d(c)("modList.gameVersion")),1),t("div",xt,[(i(!0),r(h,null,y(D.value,n=>(i(),r("button",{key:n.id,onClick:o=>_e(n.id),class:x(["badge border",p.value.includes(n.id)?"bg-info text-dark border-info":"bg-transparent text-muted border-secondary"]),style:{cursor:"pointer","user-select":"none"}},l(n.version_name),11,kt))),128))])]),t("div",wt,[t("h6",null,l(d(c)("modList.sortBy")),1),t("div",Ct,[(i(),r(h,null,y(ie,n=>t("button",{key:n.value,onClick:o=>L.value=n.value,class:x(["badge border",L.value===n.value?"bg-info text-dark border-info":"bg-transparent text-muted border-secondary"]),style:{cursor:"pointer","user-select":"none"}},[t("i",{class:x([n.icon,"me-1"])},null,2),u(l(n.label),1)],10,Lt)),64))])])]),t("div",Nt,[t("button",{class:"btn btn-sm btn-outline-warning w-100",onClick:ee},[e[10]||(e[10]=t("i",{class:"bi bi-arrow-counterclockwise"},null,-1)),u(" "+l(d(c)("modList.resetFilters")),1)])])])])]),t("div",St,[z.value?(i(),r("div",Vt,[...e[11]||(e[11]=[t("div",{class:"spinner-border text-info",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1),t("p",{class:"text-muted mt-3"},"正在扫描信号源...",-1)])])):$.value?(i(),r("div",jt,[e[13]||(e[13]=t("i",{class:"bi bi-exclamation-triangle fs-1 d-block mb-3"},null,-1)),t("p",null,l($.value),1),t("button",{class:"btn btn-outline-info btn-sm",onClick:S},[...e[12]||(e[12]=[t("i",{class:"bi bi-arrow-clockwise"},null,-1),u(" 重试 ",-1)])])])):(i(),r("div",Mt,[t("div",Tt,[t("table",$t,[t("thead",null,[t("tr",null,[e[14]||(e[14]=t("th",{scope:"col",style:{width:"50px"}},"#",-1)),t("th",zt,l(d(c)("modList.modInfo")),1),t("th",Pt,l(d(c)("modList.catsTags")),1),t("th",qt,l(d(c)("modList.download")),1)])]),t("tbody",null,[X.value.length===0?(i(),r("tr",Ft,[t("td",Bt,[e[15]||(e[15]=t("i",{class:"bi bi-radar fs-1 d-block mb-3"},null,-1)),u(" "+l(d(c)("modList.noResults")),1)])])):T("",!0),(i(!0),r(h,null,y(X.value,n=>(i(),r("tr",{key:n.id,class:"mod-row"},[t("td",Ot,l(n.id),1),t("td",null,[t("div",Rt,[t("div",Dt,[n.thumbnail?(i(),r("img",{key:0,src:n.thumbnail,alt:"cover",style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,At)):(i(),r("i",Gt))]),t("div",null,[t("div",Ut,[Q(a,{to:d(Ae)(d(k),n.id,n.title_en),class:"fw-bold text-decoration-none text-white fs-6"},{default:F(()=>[u(l(d(k)==="zh"&&n.title_cn||n.title_en),1)]),_:2},1032,["to"]),t("span",{class:"small ss-text-mono text-tech ms-1",title:d(c)("modList.author")},[e[16]||(e[16]=t("i",{class:"bi bi-person-fill"},null,-1)),u(" "+l(n.author),1)],8,Et),t("span",{class:x(["small ss-text-mono ms-1",we(n.download_cnt)]),title:d(c)("modList.downloads")},[e[17]||(e[17]=t("i",{class:"bi bi-download"},null,-1)),u(" "+l(xe(n.download_cnt)),1)],10,It),t("span",{class:"small ss-text-mono text-muted ms-1",title:d(c)("modList.updated")},[e[18]||(e[18]=t("i",{class:"bi bi-clock-history"},null,-1)),u(" "+l(ke(n.updated_at)),1)],8,Jt)]),t("div",Qt,l(d(k)==="zh"&&n.short_desc_cn||n.short_desc_en),1)])])]),t("td",null,[t("div",Yt,[Q(a,{to:{name:"mod-list",query:{t:n.content_type_id}},class:"badge badge-category text-decoration-none"},{default:F(()=>[u(l(me(n.content_type_id)),1)]),_:2},1032,["to"]),(i(!0),r(h,null,y(be(n),o=>(i(),oe(a,{key:"tag-"+o,to:{name:"mod-list",query:{tag:o}},class:"badge border bg-transparent border-secondary text-decoration-none",style:{"font-size":"0.7rem",color:"#6dcff6"}},{default:F(()=>[u(l(ve(o)),1)]),_:2},1032,["to"]))),128)),(i(!0),r(h,null,y(ye(n),o=>(i(),oe(a,{key:"col-"+o,to:{name:"mod-list",query:{col:o}},class:"badge border bg-transparent border-secondary text-decoration-none",style:{"font-size":"0.7rem",color:"#d4a574"}},{default:F(()=>[e[19]||(e[19]=t("i",{class:"bi bi-collection me-1"},null,-1)),u(l(he(o)),1)]),_:2},1032,["to"]))),128))])]),t("td",null,[E(n).length>0?(i(),r("div",Zt,[(i(!0),r(h,null,y(E(n),o=>(i(),r("button",{key:o.id,onClick:b=>se(o),class:"btn btn-sm btn-download d-flex align-items-center text-decoration-none mb-1","data-bs-toggle":"modal","data-bs-target":"#downloadModal"},[e[20]||(e[20]=t("i",{class:"bi bi-download me-1"},null,-1)),t("span",null,l(d(le)(o.version_number)),1),M(o).length>0||j(o).length>0?(i(),r("small",Kt,[u(l(M(o).join("/"))+" ",1),M(o).length>0&&j(o).length>0?(i(),r("span",Wt," - ")):T("",!0),u(" "+l(j(o).join("/")),1)])):T("",!0)],8,Ht))),128)),(i(!0),r(h,null,y(Ce(n),o=>(i(),r("div",{key:o.id},[t("button",{onClick:b=>se(o),class:"btn btn-sm btn-download btn-download-secondary d-flex align-items-center text-decoration-none mb-1","data-bs-toggle":"modal","data-bs-target":"#downloadModal"},[e[21]||(e[21]=t("i",{class:"bi bi-clock-history me-1"},null,-1)),t("span",null,l(d(le)(o.version_number)),1),M(o).length>0||j(o).length>0?(i(),r("small",es,[u(l(M(o).join("/"))+" ",1),M(o).length>0&&j(o).length>0?(i(),r("span",ts," - ")):T("",!0),u(" "+l(j(o).join("/")),1)])):T("",!0)],8,Xt)]))),128))])):(i(),r("div",ss,"-"))])]))),128))])])])])),!z.value&&!$.value?(i(),r("div",ns,[t("div",os,[t("span",ls,l(d(c)("modList.perPage"))+":",1),ne(t("select",{class:"form-select form-select-sm bg-dark text-white border-secondary",style:{width:"auto"},"onUpdate:modelValue":e[1]||(e[1]=n=>N.value=n)},[...e[22]||(e[22]=[t("option",{value:1},"1",-1),t("option",{value:10},"10",-1),t("option",{value:20},"20",-1),t("option",{value:50},"50",-1)])],512),[[Me,N.value]])]),t("nav",as,[t("ul",is,[t("li",{class:x(["page-item",{disabled:v.value===1}])},[t("a",{class:"page-link",href:"#",onClick:e[2]||(e[2]=Y(n=>U(v.value-1),["prevent"]))},"«")],2),(i(!0),r(h,null,y(ue.value,(n,o)=>(i(),r("li",{key:o,class:x(["page-item",{active:v.value===n,disabled:n==="..."}])},[t("a",{class:"page-link",href:"#",onClick:Y(b=>typeof n=="number"&&U(n),["prevent"])},l(n),9,rs)],2))),128)),t("li",{class:x(["page-item",{disabled:v.value===P.value}])},[t("a",{class:"page-link",href:"#",onClick:e[3]||(e[3]=Y(n=>U(v.value+1),["prevent"]))},"»")],2)])])])):T("",!0)])])]),Q(qe,{version:te.value},null,8,["version"])])}}}),vs=Pe(ds,[["__scopeId","data-v-aad291f1"]]);export{vs as default};
