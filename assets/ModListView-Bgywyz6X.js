import{d as Ce,u as Le,r as m,w as q,o as Ne,c as E,a as r,b as t,e as J,f as u,t as a,g as d,h as te,v as Ve,F as h,i as y,j as M,k as Se,n as x,l as I,m as je,p as Me,q as Te,s as i,x as z,y as se,_ as $e}from"./index-9sMsGaeU.js";import{_ as Pe,g as qe,a as ze,b as Fe,c as Oe,d as Be,e as Re,f as ne,h as De}from"./slug-30UYkG0l.js";const Ae={class:"py-5 border-bottom border-dark mb-4",style:{background:"rgba(0,0,0,0.2)"}},Ge={class:"container-fluid px-4"},Ue={class:"row align-items-center"},Ee={class:"col-md-8"},Je={class:"display-6 fw-bold text-white mb-2",style:{"font-family":"'Rajdhani', sans-serif"}},Ie={class:"lead text-muted fs-6 mb-0"},Qe={class:"col-md-4 text-md-end"},Ye={class:"text-muted small mb-2"},Ze={class:"text-cyan fw-bold"},He={class:"container-fluid px-4 py-4"},Ke={class:"row g-4"},We={class:"col-lg-2 col-md-3"},Xe={class:"d-grid d-md-none mb-3"},et={class:"btn btn-outline-info",type:"button","data-bs-toggle":"offcanvas","data-bs-target":"#filterCanvas"},tt={class:"offcanvas-md offcanvas-start",tabindex:"-1",id:"filterCanvas"},st={class:"ss-panel ss-corner h-100 d-flex flex-column",style:{"background-color":"#1e252e !important"}},nt={class:"d-flex justify-content-between align-items-center p-3 pb-0 d-md-none"},ot={class:"offcanvas-title"},lt={class:"flex-grow-1 overflow-y-auto p-3"},at={class:"mb-4"},it={class:"input-group input-group-sm"},rt=["placeholder"],dt={class:"mb-4"},ct={class:"d-flex flex-wrap gap-1"},ut=["onClick"],mt={class:"mb-4"},bt={class:"d-flex flex-wrap gap-1"},vt=["onClick"],gt={class:"mb-4"},_t={class:"d-flex flex-wrap gap-1"},ft=["onClick"],pt={class:"mb-4"},ht={class:"d-flex flex-wrap gap-1"},yt=["onClick"],xt={class:"mb-4"},kt={class:"d-flex flex-wrap gap-1"},wt=["onClick"],Ct={class:"p-3 border-top border-secondary"},Lt={class:"col-lg-10 col-md-9"},Nt={key:0,class:"text-center py-5"},Vt={key:1,class:"text-center py-5 text-danger"},St={key:2,class:"ss-panel ss-corner"},jt={class:"table-responsive"},Mt={class:"table table-hover mb-0"},Tt={scope:"col",style:{width:"55%"}},$t={scope:"col",style:{width:"20%"}},Pt={scope:"col",style:{width:"20%"}},qt={key:0},zt={colspan:"4",class:"text-center py-5 text-muted"},Ft={class:"text-center text-muted ss-text-mono small"},Ot={class:"d-flex gap-3 align-items-start"},Bt={class:"rounded bg-dark d-flex align-items-center justify-content-center border border-secondary",style:{width:"50px",height:"50px","min-width":"50px",overflow:"hidden"}},Rt=["src"],Dt={key:1,class:"bi bi-box-seam text-muted"},At={class:"d-flex align-items-baseline flex-wrap gap-2"},Gt=["title"],Ut=["title"],Et=["title"],Jt={class:"small text-muted mt-1",style:{display:"-webkit-box","-webkit-line-clamp":"2","-webkit-box-orient":"vertical",overflow:"hidden","line-height":"1.5"}},It={class:"d-flex flex-wrap gap-1"},Qt={key:0},Yt=["onClick"],Zt={key:0,class:"text-muted ms-2"},Ht={key:0},Kt=["onClick"],Wt={key:0,class:"text-muted ms-2"},Xt={key:0},es={key:1,class:"text-muted small"},ts={key:3,class:"mt-4 d-flex justify-content-between align-items-center"},ss={class:"d-flex align-items-center gap-2"},ns={class:"text-muted small"},os={"aria-label":"Page navigation"},ls={class:"pagination pagination-sm ss-pagination mb-0"},as=["onClick"],is=Ce({__name:"ModListView",setup(rs){const Q=je(),oe=Me(),{t:c,locale:k}=Le(),$=m(!1),T=m(null),w=m(""),g=m([]),_=m([]),f=m([]),p=m([]),L=m("sort_order desc"),N=m(10),b=m(1),Y=m([]),F=m([]),O=m([]),B=m([]),R=m([]),Z=m(0),P=m(1),le=[{value:"sort_order desc",label:"推荐排序",icon:"bi bi-star-fill"},{value:"updated_at desc",label:"最近更新",icon:"bi bi-clock-history"},{value:"download_cnt desc",label:"下载量",icon:"bi bi-download"},{value:"published_at desc",label:"发布日期",icon:"bi bi-calendar-plus"},{value:"average_rating desc",label:"评分",icon:"bi bi-heart-fill"},{value:"title_cn asc",label:"名称 A-Z",icon:"bi bi-sort-alpha-down"}],V=async()=>{$.value=!0,T.value=null;try{const[s,e]=L.value.split(" "),l={page:b.value,per_page:N.value,sort:s,order:e,"filter[status_id]":99,embed:"content-collections,mod-metas,mod-versions.game-versions,content-tags"};w.value.trim()&&(l.search=w.value.trim()),g.value.length>0&&(l["filter[content_type_id]"]="in:"+g.value.join(",")),_.value.length>0&&(l["filter[tag]"]=_.value.join(",")),f.value.length>0&&(l["filter[collection]"]=f.value.join(",")),p.value.length>0&&(l["filter[game_version]"]=p.value.join(","));const n=await qe(l);Y.value=n.data,Z.value=n.meta.total,P.value=n.meta.total_pages}catch(s){T.value=s.message||"Failed to load data",console.error("Failed to fetch contents:",s)}finally{$.value=!1}},ae=async()=>{try{const[s,e,l,n]=await Promise.all([ze(),Fe(),Oe(),Be()]);F.value=s.data,O.value=e.data,B.value=l.data,R.value=n.data}catch(s){console.error("Failed to fetch metadata:",s)}},H=()=>{const s=Q.query;s.q&&(w.value=String(s.q)),s.t&&(g.value=String(s.t).split(",").map(Number).filter(e=>!isNaN(e))),s.tag&&(_.value=String(s.tag).split(",").map(Number).filter(e=>!isNaN(e))),s.col&&(f.value=String(s.col).split(",").map(Number).filter(e=>!isNaN(e))),s.v&&(p.value=String(s.v).split(",").map(Number).filter(e=>!isNaN(e))),s.sort&&(L.value=String(s.sort)),s.page&&(b.value=Number(s.page)||1),s.per&&(N.value=Number(s.per)||10)},D=()=>{const s={};w.value.trim()&&(s.q=w.value.trim()),g.value.length>0&&(s.t=g.value.join(",")),_.value.length>0&&(s.tag=_.value.join(",")),f.value.length>0&&(s.col=f.value.join(",")),p.value.length>0&&(s.v=p.value.join(",")),L.value!=="sort_order desc"&&(s.sort=L.value),b.value>1&&(s.page=String(b.value)),N.value!==10&&(s.per=String(N.value)),oe.replace({query:s})};let A=null;const ie=()=>{A&&clearTimeout(A),A=setTimeout(()=>{b.value=1,V(),D()},1e3)};q(w,()=>{ie()}),q([g,_,f,p,L,N],()=>{b.value=1,V(),D()},{deep:!0}),q(b,()=>{V(),D()}),q(()=>Q.query,(s,e)=>{JSON.stringify(s)!==JSON.stringify(e)&&(H(),V())},{deep:!0}),Ne(()=>{H(),ae(),V()});const K=E(()=>Y.value),re=E(()=>Z.value),de=E(()=>{const s=P.value,e=b.value,l=2,n=[];if(s<=8)for(let o=1;o<=s;o++)n.push(o);else{n.push(1);let o=Math.max(2,e-l),v=Math.min(s-2,e+l);o>2&&n.push("...");for(let C=o;C<=v;C++)n.push(C);v<s-2&&n.push("..."),n.push(s-1),n.push(s)}return n}),ce=s=>{const e=F.value.find(l=>l.id===s);return e?k.value==="zh"?e.name_cn:e.name_en:String(s)},ue=s=>{const e=O.value.find(l=>l.id===s);return e?k.value==="zh"?e.name_cn:e.name_en:String(s)},me=s=>{const e=s["content-tags"];return!e||!Array.isArray(e)?[]:e.map(l=>l.tag_id)},S=s=>{const e=[];return s.support_cn&&e.push("CN"),s.support_en&&e.push("EN"),e},j=s=>!s["game-versions"]||s["game-versions"].length===0?[]:s["game-versions"].map(l=>R.value.find(n=>n.id===l.game_version_id)).filter(Boolean).sort((l,n)=>((n==null?void 0:n.sort_order)||0)-((l==null?void 0:l.sort_order)||0)).slice(0,2).map(l=>{if(!l)return"";const n=l.version_name.match(/^([\d.]+[a-z]?)/i);return n?n[1]:l.version_name}).filter(Boolean),be=s=>{const e=_.value.indexOf(s);e>=0?_.value.splice(e,1):_.value.push(s)},ve=s=>{const e=g.value.indexOf(s);e>=0?g.value.splice(e,1):g.value.push(s)},ge=s=>{const e=p.value.indexOf(s);e>=0?p.value.splice(e,1):p.value.push(s)},_e=s=>{const e=f.value.indexOf(s);e>=0?f.value.splice(e,1):f.value.push(s)},fe=s=>{const e=B.value.find(l=>l.id===s);return e?k.value==="zh"?e.name_cn:e.name_en:String(s)},pe=s=>{const e=s["content-collections"];return!e||!Array.isArray(e)?[]:e.map(l=>l.collection_id)},W=()=>{w.value="",g.value=[],_.value=[],f.value=[],p.value=[],b.value=1},G=s=>{s>=1&&s<=P.value&&(b.value=s)},he=s=>s>=1e3?(s/1e3).toFixed(1)+"k":String(s),ye=s=>{if(!s)return"-";const e=new Date(s),l=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${l}-${n}-${o}`},xe=s=>s>=1e4?"text-warning fw-bold":s>=5e3?"text-info":s>=1e3?"text-white":"text-muted",U=s=>{const e=s["mod-versions"];if(!e||e.length===0)return[];const l=De(e);return l.length>0?l.sort((o,v)=>v.version_number.localeCompare(o.version_number,void 0,{numeric:!0,sensitivity:"base"})).slice(0,3):[...e].sort((o,v)=>v.version_number.localeCompare(o.version_number,void 0,{numeric:!0,sensitivity:"base"})).slice(0,1)},ke=s=>{const e=s["mod-versions"];if(!e||e.length===0)return[];const l=U(s),n=new Set(l.map(C=>C.id)),o=Math.max(0,3-l.length);if(o===0)return[];const v=e.filter(C=>!n.has(C.id));return v.length===0?[]:v.sort((C,we)=>we.version_number.localeCompare(C.version_number,void 0,{numeric:!0,sensitivity:"base"})).slice(0,o)},X=m(null),ee=s=>{X.value=s};return(s,e)=>{const l=Te("router-link");return i(),r("div",null,[t("header",Ae,[t("div",Ge,[t("div",Ue,[t("div",Ee,[t("h1",Je,[e[4]||(e[4]=t("i",{class:"bi bi-hdd-stack me-2 text-cyan"},null,-1)),u(a(d(c)("modList.title")),1)]),t("p",Ie,a(d(c)("modList.subtitle")),1)]),t("div",Qe,[t("div",Ye,[e[5]||(e[5]=t("i",{class:"bi bi-database me-1"},null,-1)),u(" "+a(d(c)("modList.showing"))+" ",1),t("span",Ze,a(re.value),1),u(" "+a(d(c)("modList.mods")),1)]),t("button",{class:"btn btn-outline-secondary btn-sm",onClick:W},[e[6]||(e[6]=t("i",{class:"bi bi-arrow-counterclockwise"},null,-1)),u(" "+a(d(c)("modList.resetFilters")),1)])])])])]),t("main",He,[t("div",Ke,[t("div",We,[t("div",Xe,[t("button",et,[e[7]||(e[7]=t("i",{class:"bi bi-funnel"},null,-1)),u(" "+a(d(c)("modList.openFilter")),1)])]),t("div",tt,[t("div",st,[t("div",nt,[t("h5",ot,a(d(c)("modList.filterSettings")),1),e[8]||(e[8]=t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"offcanvas","data-bs-target":"#filterCanvas"},null,-1))]),t("div",lt,[t("div",at,[t("h6",null,a(d(c)("modList.quickSearch")),1),t("div",it,[e[9]||(e[9]=t("span",{class:"input-group-text bg-dark border-secondary text-muted"},[t("i",{class:"bi bi-search"})],-1)),te(t("input",{type:"text",class:"form-control bg-dark border-secondary text-white","onUpdate:modelValue":e[0]||(e[0]=n=>w.value=n),placeholder:d(c)("modList.searchPlaceholder")},null,8,rt),[[Ve,w.value]])])]),t("div",dt,[t("h6",null,a(d(c)("modList.categories")),1),t("div",ct,[(i(!0),r(h,null,y(F.value,n=>(i(),r("button",{key:n.id,onClick:o=>ve(n.id),class:x(["badge border",g.value.includes(n.id)?"bg-info text-dark border-info":"bg-transparent text-muted border-secondary"]),style:{cursor:"pointer","user-select":"none"}},a(d(k)==="zh"?n.name_cn:n.name_en),11,ut))),128))])]),t("div",mt,[t("h6",null,a(d(c)("modList.tags")),1),t("div",bt,[(i(!0),r(h,null,y(O.value,n=>(i(),r("button",{key:n.id,onClick:o=>be(n.id),class:x(["badge border",_.value.includes(n.id)?"bg-info text-dark border-info":"bg-transparent text-muted border-secondary"]),style:{cursor:"pointer","user-select":"none"}},a(d(k)==="zh"?n.name_cn:n.name_en),11,vt))),128))])]),t("div",gt,[t("h6",null,a(d(c)("modList.collections")),1),t("div",_t,[(i(!0),r(h,null,y(B.value,n=>(i(),r("button",{key:n.id,onClick:o=>_e(n.id),class:x(["badge border",f.value.includes(n.id)?"bg-info text-dark border-info":"bg-transparent text-muted border-secondary"]),style:{cursor:"pointer","user-select":"none"}},a(d(k)==="zh"?n.name_cn:n.name_en),11,ft))),128))])]),t("div",pt,[t("h6",null,a(d(c)("modList.gameVersion")),1),t("div",ht,[(i(!0),r(h,null,y(R.value,n=>(i(),r("button",{key:n.id,onClick:o=>ge(n.id),class:x(["badge border",p.value.includes(n.id)?"bg-info text-dark border-info":"bg-transparent text-muted border-secondary"]),style:{cursor:"pointer","user-select":"none"}},a(n.version_name),11,yt))),128))])]),t("div",xt,[t("h6",null,a(d(c)("modList.sortBy")),1),t("div",kt,[(i(),r(h,null,y(le,n=>t("button",{key:n.value,onClick:o=>L.value=n.value,class:x(["badge border",L.value===n.value?"bg-info text-dark border-info":"bg-transparent text-muted border-secondary"]),style:{cursor:"pointer","user-select":"none"}},[t("i",{class:x([n.icon,"me-1"])},null,2),u(a(n.label),1)],10,wt)),64))])])]),t("div",Ct,[t("button",{class:"btn btn-sm btn-outline-warning w-100",onClick:W},[e[10]||(e[10]=t("i",{class:"bi bi-arrow-counterclockwise"},null,-1)),u(" "+a(d(c)("modList.resetFilters")),1)])])])])]),t("div",Lt,[$.value?(i(),r("div",Nt,[...e[11]||(e[11]=[t("div",{class:"spinner-border text-info",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1),t("p",{class:"text-muted mt-3"},"正在扫描信号源...",-1)])])):T.value?(i(),r("div",Vt,[e[13]||(e[13]=t("i",{class:"bi bi-exclamation-triangle fs-1 d-block mb-3"},null,-1)),t("p",null,a(T.value),1),t("button",{class:"btn btn-outline-info btn-sm",onClick:V},[...e[12]||(e[12]=[t("i",{class:"bi bi-arrow-clockwise"},null,-1),u(" 重试 ",-1)])])])):(i(),r("div",St,[t("div",jt,[t("table",Mt,[t("thead",null,[t("tr",null,[e[14]||(e[14]=t("th",{scope:"col",style:{width:"50px"}},"#",-1)),t("th",Tt,a(d(c)("modList.modInfo")),1),t("th",$t,a(d(c)("modList.catsTags")),1),t("th",Pt,a(d(c)("modList.download")),1)])]),t("tbody",null,[K.value.length===0?(i(),r("tr",qt,[t("td",zt,[e[15]||(e[15]=t("i",{class:"bi bi-radar fs-1 d-block mb-3"},null,-1)),u(" "+a(d(c)("modList.noResults")),1)])])):M("",!0),(i(!0),r(h,null,y(K.value,n=>(i(),r("tr",{key:n.id,class:"mod-row"},[t("td",Ft,a(n.id),1),t("td",null,[t("div",Ot,[t("div",Bt,[n.thumbnail?(i(),r("img",{key:0,src:n.thumbnail,alt:"cover",style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,Rt)):(i(),r("i",Dt))]),t("div",null,[t("div",At,[J(l,{to:d(Re)(d(k),n.id,n.title_en),class:"fw-bold text-decoration-none text-white fs-6"},{default:z(()=>[u(a(d(k)==="zh"&&n.title_cn||n.title_en),1)]),_:2},1032,["to"]),t("span",{class:"small ss-text-mono text-tech ms-1",title:d(c)("modList.author")},[e[16]||(e[16]=t("i",{class:"bi bi-person-fill"},null,-1)),u(" "+a(n.author),1)],8,Gt),t("span",{class:x(["small ss-text-mono ms-1",xe(n.download_cnt)]),title:d(c)("modList.downloads")},[e[17]||(e[17]=t("i",{class:"bi bi-download"},null,-1)),u(" "+a(he(n.download_cnt)),1)],10,Ut),t("span",{class:"small ss-text-mono text-muted ms-1",title:d(c)("modList.updated")},[e[18]||(e[18]=t("i",{class:"bi bi-clock-history"},null,-1)),u(" "+a(ye(n.updated_at)),1)],8,Et)]),t("div",Jt,a(d(k)==="zh"&&n.short_desc_cn||n.short_desc_en),1)])])]),t("td",null,[t("div",It,[J(l,{to:{name:"mod-list",query:{t:n.content_type_id}},class:"badge badge-category text-decoration-none"},{default:z(()=>[u(a(ce(n.content_type_id)),1)]),_:2},1032,["to"]),(i(!0),r(h,null,y(me(n),o=>(i(),se(l,{key:"tag-"+o,to:{name:"mod-list",query:{tag:o}},class:"badge border bg-transparent border-secondary text-decoration-none",style:{"font-size":"0.7rem",color:"#6dcff6"}},{default:z(()=>[u(a(ue(o)),1)]),_:2},1032,["to"]))),128)),(i(!0),r(h,null,y(pe(n),o=>(i(),se(l,{key:"col-"+o,to:{name:"mod-list",query:{col:o}},class:"badge border bg-transparent border-secondary text-decoration-none",style:{"font-size":"0.7rem",color:"#d4a574"}},{default:z(()=>[e[19]||(e[19]=t("i",{class:"bi bi-collection me-1"},null,-1)),u(a(fe(o)),1)]),_:2},1032,["to"]))),128))])]),t("td",null,[U(n).length>0?(i(),r("div",Qt,[(i(!0),r(h,null,y(U(n),o=>(i(),r("button",{key:o.id,onClick:v=>ee(o),class:"btn btn-sm btn-download d-flex align-items-center text-decoration-none mb-1","data-bs-toggle":"modal","data-bs-target":"#downloadModal"},[e[20]||(e[20]=t("i",{class:"bi bi-download me-1"},null,-1)),t("span",null,a(d(ne)(o.version_number)),1),j(o).length>0||S(o).length>0?(i(),r("small",Zt,[u(a(j(o).join("/"))+" ",1),j(o).length>0&&S(o).length>0?(i(),r("span",Ht," - ")):M("",!0),u(" "+a(S(o).join("/")),1)])):M("",!0)],8,Yt))),128)),(i(!0),r(h,null,y(ke(n),o=>(i(),r("div",{key:o.id},[t("button",{onClick:v=>ee(o),class:"btn btn-sm btn-download btn-download-secondary d-flex align-items-center text-decoration-none mb-1","data-bs-toggle":"modal","data-bs-target":"#downloadModal"},[e[21]||(e[21]=t("i",{class:"bi bi-clock-history me-1"},null,-1)),t("span",null,a(d(ne)(o.version_number)),1),j(o).length>0||S(o).length>0?(i(),r("small",Wt,[u(a(j(o).join("/"))+" ",1),j(o).length>0&&S(o).length>0?(i(),r("span",Xt," - ")):M("",!0),u(" "+a(S(o).join("/")),1)])):M("",!0)],8,Kt)]))),128))])):(i(),r("div",es,"-"))])]))),128))])])])])),!$.value&&!T.value?(i(),r("div",ts,[t("div",ss,[t("span",ns,a(d(c)("modList.perPage"))+":",1),te(t("select",{class:"form-select form-select-sm bg-dark text-white border-secondary",style:{width:"auto"},"onUpdate:modelValue":e[1]||(e[1]=n=>N.value=n)},[...e[22]||(e[22]=[t("option",{value:1},"1",-1),t("option",{value:10},"10",-1),t("option",{value:20},"20",-1),t("option",{value:50},"50",-1)])],512),[[Se,N.value]])]),t("nav",os,[t("ul",ls,[t("li",{class:x(["page-item",{disabled:b.value===1}])},[t("a",{class:"page-link",href:"#",onClick:e[2]||(e[2]=I(n=>G(b.value-1),["prevent"]))},"«")],2),(i(!0),r(h,null,y(de.value,(n,o)=>(i(),r("li",{key:o,class:x(["page-item",{active:b.value===n,disabled:n==="..."}])},[t("a",{class:"page-link",href:"#",onClick:I(v=>typeof n=="number"&&G(n),["prevent"])},a(n),9,as)],2))),128)),t("li",{class:x(["page-item",{disabled:b.value===P.value}])},[t("a",{class:"page-link",href:"#",onClick:e[3]||(e[3]=I(n=>G(b.value+1),["prevent"]))},"»")],2)])])])):M("",!0)])])]),J(Pe,{version:X.value},null,8,["version"])])}}}),us=$e(is,[["__scopeId","data-v-f5c08914"]]);export{us as default};
