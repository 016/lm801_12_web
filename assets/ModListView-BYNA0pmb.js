import{d as Ne,u as Se,r as m,w as I,o as Ve,n as je,c as J,a as r,b as t,e as Q,f as u,t as l,g as d,h as ne,v as Me,F as h,i as y,j as T,k as Te,l as x,m as Y,p as ze,q as $e,s as Pe,x as i,y as F,z as oe,_ as qe}from"./index-E0v1gh1h.js";import{_ as Fe,g as Be,a as Oe,b as Re,c as De,d as Ae,e as Ge,f as le,h as Ue}from"./slug-ByQC59cd.js";const Ee={class:"py-5 border-bottom border-dark mb-4",style:{background:"rgba(0,0,0,0.2)"}},Ie={class:"container-fluid px-4"},Je={class:"row align-items-center"},Qe={class:"col-md-8"},Ye={class:"display-6 fw-bold text-white mb-2",style:{"font-family":"'Rajdhani', sans-serif"}},Ze={class:"lead text-muted fs-6 mb-0"},He={class:"col-md-4 text-md-end"},Ke={class:"text-muted small mb-2"},We={class:"text-cyan fw-bold"},Xe={class:"container-fluid px-4 py-4"},et={class:"row g-4"},tt={class:"col-lg-2 col-md-3"},st={class:"d-grid d-md-none mb-3"},nt={class:"btn btn-outline-info",type:"button","data-bs-toggle":"offcanvas","data-bs-target":"#filterCanvas"},ot={class:"offcanvas-md offcanvas-start",tabindex:"-1",id:"filterCanvas"},lt={class:"ss-panel ss-corner h-100 d-flex flex-column",style:{"background-color":"#1e252e !important"}},at={class:"d-flex justify-content-between align-items-center p-3 pb-0 d-md-none"},it={class:"offcanvas-title"},rt={class:"flex-grow-1 overflow-y-auto p-3"},dt={class:"mb-4"},ct={class:"input-group input-group-sm"},ut=["placeholder"],mt={class:"mb-4"},bt={class:"d-flex flex-wrap gap-1"},vt=["onClick"],gt={class:"mb-4"},ft={class:"d-flex flex-wrap gap-1"},_t=["onClick"],pt={class:"mb-4"},ht={class:"d-flex flex-wrap gap-1"},yt=["onClick"],xt={class:"mb-4"},kt={class:"d-flex flex-wrap gap-1"},wt=["onClick"],Ct={class:"mb-4"},Lt={class:"d-flex flex-wrap gap-1"},Nt=["onClick"],St={class:"p-3 border-top border-secondary"},Vt={class:"col-lg-10 col-md-9"},jt={key:0,class:"text-center py-5"},Mt={key:1,class:"text-center py-5 text-danger"},Tt={key:2,class:"ss-panel ss-corner"},zt={class:"table-responsive"},$t={class:"table table-hover mb-0"},Pt={scope:"col",style:{width:"55%"}},qt={scope:"col",style:{width:"20%"}},Ft={scope:"col",style:{width:"20%"}},Bt={key:0},Ot={colspan:"4",class:"text-center py-5 text-muted"},Rt={class:"text-center text-muted ss-text-mono small"},Dt={class:"d-flex gap-3 align-items-start"},At={class:"rounded bg-dark d-flex align-items-center justify-content-center border border-secondary",style:{width:"50px",height:"50px","min-width":"50px",overflow:"hidden"}},Gt=["src"],Ut={key:1,class:"bi bi-box-seam text-muted"},Et={class:"d-flex align-items-baseline flex-wrap gap-2"},It=["title"],Jt=["title"],Qt=["title"],Yt={class:"small text-muted mt-1",style:{display:"-webkit-box","-webkit-line-clamp":"2","-webkit-box-orient":"vertical",overflow:"hidden","line-height":"1.5"}},Zt={class:"d-flex flex-wrap gap-1"},Ht={key:0},Kt=["onClick"],Wt={key:0,class:"text-muted ms-2"},Xt={key:0},es=["onClick"],ts={key:0,class:"text-muted ms-2"},ss={key:0},ns={key:1,class:"text-muted small"},os={key:3,class:"mt-4 d-flex justify-content-between align-items-center"},ls={class:"d-flex align-items-center gap-2"},as={class:"text-muted small"},is={"aria-label":"Page navigation"},rs={class:"pagination pagination-sm ss-pagination mb-0"},ds=["onClick"],cs=Ne({__name:"ModListView",setup(us){const Z=ze(),ae=$e(),{t:c,locale:k}=Se(),$=m(!1),z=m(null),w=m(""),g=m([]),f=m([]),_=m([]),p=m([]),L=m("-sort_order,id"),N=m(10),b=m(1),H=m([]),B=m([]),O=m([]),R=m([]),D=m([]),K=m(0),P=m(1),ie=[{value:"-sort_order,id",label:"推荐排序",icon:"bi bi-star-fill"},{value:"-updated_at,id",label:"最近更新",icon:"bi bi-clock-history"},{value:"-download_cnt,id",label:"下载量",icon:"bi bi-download"},{value:"-published_at,id",label:"发布日期",icon:"bi bi-calendar-plus"},{value:"-average_rating,id",label:"评分",icon:"bi bi-heart-fill"},{value:"title_cn,id",label:"名称 A-Z",icon:"bi bi-sort-alpha-down"}],S=async()=>{$.value=!0,z.value=null;try{const s={page:b.value,per_page:N.value,sort:L.value,"filter[status_id]":99,embed:"content-collections,mod-metas,mod-versions.game-versions,content-tags"};w.value.trim()&&(s.search=w.value.trim()),g.value.length>0&&(s["filter[content_type_id]"]="in:"+g.value.join(",")),f.value.length>0&&(s["filter[tag]"]=f.value.join(",")),_.value.length>0&&(s["filter[collection]"]=_.value.join(",")),p.value.length>0&&(s["filter[game_version]"]=p.value.join(","));const e=await Be(s);H.value=e.data,K.value=e.meta.total,P.value=e.meta.total_pages}catch(s){z.value=s.message||"Failed to load data",console.error("Failed to fetch contents:",s)}finally{$.value=!1}},re=async()=>{try{const[s,e,a,n]=await Promise.all([Oe(),Re(),De(),Ae()]);B.value=s.data,O.value=e.data,R.value=a.data,D.value=n.data}catch(s){console.error("Failed to fetch metadata:",s)}},W=()=>{const s=Z.query;s.q&&(w.value=String(s.q)),s.t&&(g.value=String(s.t).split(",").map(Number).filter(e=>!isNaN(e))),s.tag&&(f.value=String(s.tag).split(",").map(Number).filter(e=>!isNaN(e))),s.col&&(_.value=String(s.col).split(",").map(Number).filter(e=>!isNaN(e))),s.v&&(p.value=String(s.v).split(",").map(Number).filter(e=>!isNaN(e))),s.sort&&(L.value=String(s.sort)),s.page&&(b.value=Number(s.page)||1),s.per&&(N.value=Number(s.per)||10)};let V=!1,q=!1;const A=()=>{const s={};w.value.trim()&&(s.q=w.value.trim()),g.value.length>0&&(s.t=g.value.join(",")),f.value.length>0&&(s.tag=f.value.join(",")),_.value.length>0&&(s.col=_.value.join(",")),p.value.length>0&&(s.v=p.value.join(",")),L.value!=="-sort_order,id"&&(s.sort=L.value),b.value>1&&(s.page=String(b.value)),N.value!==10&&(s.per=String(N.value)),V=!0,ae.replace({query:s}).finally(()=>{V=!1})};let G=null;const de=()=>{G&&clearTimeout(G),G=setTimeout(()=>{b.value=1,S(),A()},1e3)};I(w,()=>{q&&de()}),I([g,f,_,p,L,N],()=>{V||!q||(b.value=1,S(),A())},{deep:!0});const U=s=>{s>=1&&s<=P.value&&s!==b.value&&(b.value=s,S(),A())};I(()=>Z.query,(s,e)=>{V||!q||JSON.stringify(s)!==JSON.stringify(e)&&(V=!0,W(),V=!1,S())},{deep:!0,flush:"post"}),Ve(async()=>{W(),re(),S(),await je(),q=!0});const X=J(()=>H.value),ce=J(()=>K.value),ue=J(()=>{const s=P.value,e=b.value,a=2,n=[];if(s<=8)for(let o=1;o<=s;o++)n.push(o);else{n.push(1);let o=Math.max(2,e-a),v=Math.min(s-2,e+a);o>2&&n.push("...");for(let C=o;C<=v;C++)n.push(C);v<s-2&&n.push("..."),n.push(s-1),n.push(s)}return n}),me=s=>{const e=B.value.find(a=>a.id===s);return e?k.value==="zh"?e.name_cn:e.name_en:String(s)},be=s=>{const e=O.value.find(a=>a.id===s);return e?k.value==="zh"?e.name_cn:e.name_en:String(s)},ve=s=>{const e=s["content-tags"];return!e||!Array.isArray(e)?[]:e.map(a=>a.tag_id)},j=s=>{const e=[];return s.support_cn&&e.push("CN"),s.support_en&&e.push("EN"),e},M=s=>!s["game-versions"]||s["game-versions"].length===0?[]:s["game-versions"].map(a=>D.value.find(n=>n.id===a.game_version_id)).filter(Boolean).sort((a,n)=>((n==null?void 0:n.sort_order)||0)-((a==null?void 0:a.sort_order)||0)).slice(0,2).map(a=>{if(!a)return"";const n=a.version_name.match(/^([\d.]+[a-z]?)/i);return n?n[1]:a.version_name}).filter(Boolean),ge=s=>{const e=f.value.indexOf(s);e>=0?f.value.splice(e,1):f.value.push(s)},fe=s=>{const e=g.value.indexOf(s);e>=0?g.value.splice(e,1):g.value.push(s)},_e=s=>{const e=p.value.indexOf(s);e>=0?p.value.splice(e,1):p.value.push(s)},pe=s=>{const e=_.value.indexOf(s);e>=0?_.value.splice(e,1):_.value.push(s)},he=s=>{const e=R.value.find(a=>a.id===s);return e?k.value==="zh"?e.name_cn:e.name_en:String(s)},ye=s=>{const e=s["content-collections"];return!e||!Array.isArray(e)?[]:e.map(a=>a.collection_id)},ee=()=>{w.value="",g.value=[],f.value=[],_.value=[],p.value=[],b.value=1},xe=s=>s>=1e3?(s/1e3).toFixed(1)+"k":String(s),ke=s=>{if(!s)return"-";const e=new Date(s),a=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${a}-${n}-${o}`},we=s=>s>=1e4?"text-warning fw-bold":s>=5e3?"text-info":s>=1e3?"text-white":"text-muted",E=s=>{const e=s["mod-versions"];if(!e||e.length===0)return[];const a=Ue(e);return a.length>0?a.sort((o,v)=>v.version_number.localeCompare(o.version_number,void 0,{numeric:!0,sensitivity:"base"})).slice(0,3):[...e].sort((o,v)=>v.version_number.localeCompare(o.version_number,void 0,{numeric:!0,sensitivity:"base"})).slice(0,1)},Ce=s=>{const e=s["mod-versions"];if(!e||e.length===0)return[];const a=E(s),n=new Set(a.map(C=>C.id)),o=Math.max(0,3-a.length);if(o===0)return[];const v=e.filter(C=>!n.has(C.id));return v.length===0?[]:v.sort((C,Le)=>Le.version_number.localeCompare(C.version_number,void 0,{numeric:!0,sensitivity:"base"})).slice(0,o)},te=m(null),se=s=>{te.value=s};return(s,e)=>{const a=Pe("router-link");return i(),r("div",null,[t("header",Ee,[t("div",Ie,[t("div",Je,[t("div",Qe,[t("h1",Ye,[e[4]||(e[4]=t("i",{class:"bi bi-hdd-stack me-2 text-cyan"},null,-1)),u(l(d(c)("modList.title")),1)]),t("p",Ze,l(d(c)("modList.subtitle")),1)]),t("div",He,[t("div",Ke,[e[5]||(e[5]=t("i",{class:"bi bi-database me-1"},null,-1)),u(" "+l(d(c)("modList.showing"))+" ",1),t("span",We,l(ce.value),1),u(" "+l(d(c)("modList.mods")),1)]),t("button",{class:"btn btn-outline-secondary btn-sm",onClick:ee},[e[6]||(e[6]=t("i",{class:"bi bi-arrow-counterclockwise"},null,-1)),u(" "+l(d(c)("modList.resetFilters")),1)])])])])]),t("main",Xe,[t("div",et,[t("div",tt,[t("div",st,[t("button",nt,[e[7]||(e[7]=t("i",{class:"bi bi-funnel"},null,-1)),u(" "+l(d(c)("modList.openFilter")),1)])]),t("div",ot,[t("div",lt,[t("div",at,[t("h5",it,l(d(c)("modList.filterSettings")),1),e[8]||(e[8]=t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"offcanvas","data-bs-target":"#filterCanvas"},null,-1))]),t("div",rt,[t("div",dt,[t("h6",null,l(d(c)("modList.quickSearch")),1),t("div",ct,[e[9]||(e[9]=t("span",{class:"input-group-text bg-dark border-secondary text-muted"},[t("i",{class:"bi bi-search"})],-1)),ne(t("input",{type:"text",class:"form-control bg-dark border-secondary text-white","onUpdate:modelValue":e[0]||(e[0]=n=>w.value=n),placeholder:d(c)("modList.searchPlaceholder")},null,8,ut),[[Me,w.value]])])]),t("div",mt,[t("h6",null,l(d(c)("modList.categories")),1),t("div",bt,[(i(!0),r(h,null,y(B.value,n=>(i(),r("button",{key:n.id,onClick:o=>fe(n.id),class:x(["badge border",g.value.includes(n.id)?"bg-info text-dark border-info":"bg-transparent text-muted border-secondary"]),style:{cursor:"pointer","user-select":"none"}},l(d(k)==="zh"?n.name_cn:n.name_en),11,vt))),128))])]),t("div",gt,[t("h6",null,l(d(c)("modList.tags")),1),t("div",ft,[(i(!0),r(h,null,y(O.value,n=>(i(),r("button",{key:n.id,onClick:o=>ge(n.id),class:x(["badge border",f.value.includes(n.id)?"bg-info text-dark border-info":"bg-transparent text-muted border-secondary"]),style:{cursor:"pointer","user-select":"none"}},l(d(k)==="zh"?n.name_cn:n.name_en),11,_t))),128))])]),t("div",pt,[t("h6",null,l(d(c)("modList.collections")),1),t("div",ht,[(i(!0),r(h,null,y(R.value,n=>(i(),r("button",{key:n.id,onClick:o=>pe(n.id),class:x(["badge border",_.value.includes(n.id)?"bg-info text-dark border-info":"bg-transparent text-muted border-secondary"]),style:{cursor:"pointer","user-select":"none"}},l(d(k)==="zh"?n.name_cn:n.name_en),11,yt))),128))])]),t("div",xt,[t("h6",null,l(d(c)("modList.gameVersion")),1),t("div",kt,[(i(!0),r(h,null,y(D.value,n=>(i(),r("button",{key:n.id,onClick:o=>_e(n.id),class:x(["badge border",p.value.includes(n.id)?"bg-info text-dark border-info":"bg-transparent text-muted border-secondary"]),style:{cursor:"pointer","user-select":"none"}},l(n.version_name),11,wt))),128))])]),t("div",Ct,[t("h6",null,l(d(c)("modList.sortBy")),1),t("div",Lt,[(i(),r(h,null,y(ie,n=>t("button",{key:n.value,onClick:o=>L.value=n.value,class:x(["badge border",L.value===n.value?"bg-info text-dark border-info":"bg-transparent text-muted border-secondary"]),style:{cursor:"pointer","user-select":"none"}},[t("i",{class:x([n.icon,"me-1"])},null,2),u(l(n.label),1)],10,Nt)),64))])])]),t("div",St,[t("button",{class:"btn btn-sm btn-outline-warning w-100",onClick:ee},[e[10]||(e[10]=t("i",{class:"bi bi-arrow-counterclockwise"},null,-1)),u(" "+l(d(c)("modList.resetFilters")),1)])])])])]),t("div",Vt,[$.value?(i(),r("div",jt,[...e[11]||(e[11]=[t("div",{class:"spinner-border text-info",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1),t("p",{class:"text-muted mt-3"},"正在扫描信号源...",-1)])])):z.value?(i(),r("div",Mt,[e[13]||(e[13]=t("i",{class:"bi bi-exclamation-triangle fs-1 d-block mb-3"},null,-1)),t("p",null,l(z.value),1),t("button",{class:"btn btn-outline-info btn-sm",onClick:S},[...e[12]||(e[12]=[t("i",{class:"bi bi-arrow-clockwise"},null,-1),u(" 重试 ",-1)])])])):(i(),r("div",Tt,[t("div",zt,[t("table",$t,[t("thead",null,[t("tr",null,[e[14]||(e[14]=t("th",{scope:"col",style:{width:"50px"}},"#",-1)),t("th",Pt,l(d(c)("modList.modInfo")),1),t("th",qt,l(d(c)("modList.catsTags")),1),t("th",Ft,l(d(c)("modList.download")),1)])]),t("tbody",null,[X.value.length===0?(i(),r("tr",Bt,[t("td",Ot,[e[15]||(e[15]=t("i",{class:"bi bi-radar fs-1 d-block mb-3"},null,-1)),u(" "+l(d(c)("modList.noResults")),1)])])):T("",!0),(i(!0),r(h,null,y(X.value,n=>(i(),r("tr",{key:n.id,class:"mod-row"},[t("td",Rt,l(n.id),1),t("td",null,[t("div",Dt,[t("div",At,[n.thumbnail?(i(),r("img",{key:0,src:n.thumbnail,alt:"cover",style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,Gt)):(i(),r("i",Ut))]),t("div",null,[t("div",Et,[Q(a,{to:d(Ge)(d(k),n.id,n.title_en),class:"fw-bold text-decoration-none text-white fs-6"},{default:F(()=>[u(l(d(k)==="zh"&&n.title_cn||n.title_en),1)]),_:2},1032,["to"]),t("span",{class:"small ss-text-mono text-tech ms-1",title:d(c)("modList.author")},[e[16]||(e[16]=t("i",{class:"bi bi-person-fill"},null,-1)),u(" "+l(n.author),1)],8,It),t("span",{class:x(["small ss-text-mono ms-1",we(n.download_cnt)]),title:d(c)("modList.downloads")},[e[17]||(e[17]=t("i",{class:"bi bi-download"},null,-1)),u(" "+l(xe(n.download_cnt)),1)],10,Jt),t("span",{class:"small ss-text-mono text-muted ms-1",title:d(c)("modList.updated")},[e[18]||(e[18]=t("i",{class:"bi bi-clock-history"},null,-1)),u(" "+l(ke(n.updated_at)),1)],8,Qt)]),t("div",Yt,l(d(k)==="zh"&&n.short_desc_cn||n.short_desc_en),1)])])]),t("td",null,[t("div",Zt,[Q(a,{to:{name:"mod-list",query:{t:n.content_type_id}},class:"badge badge-category text-decoration-none"},{default:F(()=>[u(l(me(n.content_type_id)),1)]),_:2},1032,["to"]),(i(!0),r(h,null,y(ve(n),o=>(i(),oe(a,{key:"tag-"+o,to:{name:"mod-list",query:{tag:o}},class:"badge border bg-transparent border-secondary text-decoration-none",style:{"font-size":"0.7rem",color:"#6dcff6"}},{default:F(()=>[u(l(be(o)),1)]),_:2},1032,["to"]))),128)),(i(!0),r(h,null,y(ye(n),o=>(i(),oe(a,{key:"col-"+o,to:{name:"mod-list",query:{col:o}},class:"badge border bg-transparent border-secondary text-decoration-none",style:{"font-size":"0.7rem",color:"#d4a574"}},{default:F(()=>[e[19]||(e[19]=t("i",{class:"bi bi-collection me-1"},null,-1)),u(l(he(o)),1)]),_:2},1032,["to"]))),128))])]),t("td",null,[E(n).length>0?(i(),r("div",Ht,[(i(!0),r(h,null,y(E(n),o=>(i(),r("button",{key:o.id,onClick:v=>se(o),class:"btn btn-sm btn-download d-flex align-items-center text-decoration-none mb-1","data-bs-toggle":"modal","data-bs-target":"#downloadModal"},[e[20]||(e[20]=t("i",{class:"bi bi-download me-1"},null,-1)),t("span",null,l(d(le)(o.version_number)),1),M(o).length>0||j(o).length>0?(i(),r("small",Wt,[u(l(M(o).join("/"))+" ",1),M(o).length>0&&j(o).length>0?(i(),r("span",Xt," - ")):T("",!0),u(" "+l(j(o).join("/")),1)])):T("",!0)],8,Kt))),128)),(i(!0),r(h,null,y(Ce(n),o=>(i(),r("div",{key:o.id},[t("button",{onClick:v=>se(o),class:"btn btn-sm btn-download btn-download-secondary d-flex align-items-center text-decoration-none mb-1","data-bs-toggle":"modal","data-bs-target":"#downloadModal"},[e[21]||(e[21]=t("i",{class:"bi bi-clock-history me-1"},null,-1)),t("span",null,l(d(le)(o.version_number)),1),M(o).length>0||j(o).length>0?(i(),r("small",ts,[u(l(M(o).join("/"))+" ",1),M(o).length>0&&j(o).length>0?(i(),r("span",ss," - ")):T("",!0),u(" "+l(j(o).join("/")),1)])):T("",!0)],8,es)]))),128))])):(i(),r("div",ns,"-"))])]))),128))])])])])),!$.value&&!z.value?(i(),r("div",os,[t("div",ls,[t("span",as,l(d(c)("modList.perPage"))+":",1),ne(t("select",{class:"form-select form-select-sm bg-dark text-white border-secondary",style:{width:"auto"},"onUpdate:modelValue":e[1]||(e[1]=n=>N.value=n)},[...e[22]||(e[22]=[t("option",{value:1},"1",-1),t("option",{value:10},"10",-1),t("option",{value:20},"20",-1),t("option",{value:50},"50",-1)])],512),[[Te,N.value]])]),t("nav",is,[t("ul",rs,[t("li",{class:x(["page-item",{disabled:b.value===1}])},[t("a",{class:"page-link",href:"#",onClick:e[2]||(e[2]=Y(n=>U(b.value-1),["prevent"]))},"«")],2),(i(!0),r(h,null,y(ue.value,(n,o)=>(i(),r("li",{key:o,class:x(["page-item",{active:b.value===n,disabled:n==="..."}])},[t("a",{class:"page-link",href:"#",onClick:Y(v=>typeof n=="number"&&U(n),["prevent"])},l(n),9,ds)],2))),128)),t("li",{class:x(["page-item",{disabled:b.value===P.value}])},[t("a",{class:"page-link",href:"#",onClick:e[3]||(e[3]=Y(n=>U(b.value+1),["prevent"]))},"»")],2)])])])):T("",!0)])])]),Q(Fe,{version:te.value},null,8,["version"])])}}}),vs=qe(cs,[["__scopeId","data-v-bee5c15f"]]);export{vs as default};
